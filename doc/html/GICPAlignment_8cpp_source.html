<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<title>leica_point_cloud_processing: GICPAlignment.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="jquery.js"></script>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">GICPAlignment.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="GICPAlignment_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="GICPAlignment_8h.html">GICPAlignment.h</a>&gt;</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno"><a class="line" href="classGICPAlignment.html#a63fdc9dad8f08643cd3901502d49845a">    3</a></span>&#160;<a class="code" href="classGICPAlignment.html#a63fdc9dad8f08643cd3901502d49845a">GICPAlignment::GICPAlignment</a>(PointCloudRGB::Ptr target_cloud, PointCloudRGB::Ptr source_cloud)</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    : _aligned_cloud(new <a class="code" href="classGICPAlignment.html#a33aac7b6f7df6fda4d8403c7431b93a0">PointCloudRGB</a>), _backup_cloud(new <a class="code" href="classGICPAlignment.html#a33aac7b6f7df6fda4d8403c7431b93a0">PointCloudRGB</a>)</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;{</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    <a class="code" href="classGICPAlignment.html#a6826da44323f592cd6fab9e87cef2a6d">_target_cloud</a> = target_cloud;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    <a class="code" href="classGICPAlignment.html#abe80f79c8554e90e792f3352173104c6">_source_cloud</a> = source_cloud;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    <a class="code" href="classGICPAlignment.html#a353796413dbd153536e5e6286502ddd8">transform_exists</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    <a class="code" href="classGICPAlignment.html#acec7c1daa76528fde5a0edc20c386e06">_fine_tf</a> = Eigen::Matrix4f::Zero();</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    </div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    <a class="code" href="classGICPAlignment.html#adbc117474b6263b415d8cc5704842a52">configParameters</a>();</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;}</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno"><a class="line" href="classGICPAlignment.html#af34f9575663c52fdce0796a7421dbb75">   14</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classGICPAlignment.html#af34f9575663c52fdce0796a7421dbb75">GICPAlignment::run</a>()</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;{</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    <a class="code" href="classGICPAlignment.html#aabbf7165ff9ce2b1d9518559434f0a54">fineAlignment</a>(<a class="code" href="classGICPAlignment.html#abe80f79c8554e90e792f3352173104c6">_source_cloud</a>, <a class="code" href="classGICPAlignment.html#a6826da44323f592cd6fab9e87cef2a6d">_target_cloud</a>);</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    <a class="code" href="classGICPAlignment.html#a5274769f0978ddf65db6af09e749b261">applyTFtoCloud</a>(<a class="code" href="classGICPAlignment.html#abe80f79c8554e90e792f3352173104c6">_source_cloud</a>);</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;}</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno"><a class="line" href="classGICPAlignment.html#a49a9a3ba2b38baee4359bfa390a1aa5a">   21</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classGICPAlignment.html#a49a9a3ba2b38baee4359bfa390a1aa5a">GICPAlignment::iterate</a>()</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;{</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    <a class="code" href="classGICPAlignment.html#a8539204e89dbb2a8467420f0a5d77074">iterateFineAlignment</a>(<a class="code" href="classGICPAlignment.html#ac0d4e47bde2f8f7cc2c47b2389480a8f">_aligned_cloud</a>);</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;}</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno"><a class="line" href="classGICPAlignment.html#ac13e747b98b90f29e47024450b4e0fba">   26</a></span>&#160;Eigen::Matrix4f <a class="code" href="classGICPAlignment.html#ac13e747b98b90f29e47024450b4e0fba">GICPAlignment::getFineTransform</a>()</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;{</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="classGICPAlignment.html#a353796413dbd153536e5e6286502ddd8">transform_exists</a>)</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;        ROS_ERROR(<span class="stringliteral">&quot;No transform yet. Please run algorithm&quot;</span>);</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classGICPAlignment.html#acec7c1daa76528fde5a0edc20c386e06">_fine_tf</a>;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;}</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno"><a class="line" href="classGICPAlignment.html#a8980d10505bf7567f1aded90734376df">   33</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classGICPAlignment.html#a8980d10505bf7567f1aded90734376df">GICPAlignment::getAlignedCloud</a>(PointCloudRGB::Ptr aligned_cloud)</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;{</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    pcl::copyPointCloud(*<a class="code" href="classGICPAlignment.html#ac0d4e47bde2f8f7cc2c47b2389480a8f">_aligned_cloud</a>, *aligned_cloud);</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;}</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="classGICPAlignment.html#ad0935eeab16c6f8fecf2ab618e618eaa">   38</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classGICPAlignment.html#ad0935eeab16c6f8fecf2ab618e618eaa">GICPAlignment::getAlignedCloudROSMsg</a>(sensor_msgs::PointCloud2 &amp;aligned_cloud_msg)</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;{   </div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    pcl::toROSMsg(*<a class="code" href="classGICPAlignment.html#ac0d4e47bde2f8f7cc2c47b2389480a8f">_aligned_cloud</a>,aligned_cloud_msg);</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    aligned_cloud_msg.header.frame_id = <a class="code" href="classUtils.html#a25af90b468b8971e7d0e712bef9c7085">Utils::_frame_id</a>;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    aligned_cloud_msg.header.stamp = ros::Time::now();</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;}</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="classGICPAlignment.html#adbc117474b6263b415d8cc5704842a52">   45</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classGICPAlignment.html#adbc117474b6263b415d8cc5704842a52">GICPAlignment::configParameters</a>()</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;{</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="keywordtype">double</span> target_res = <a class="code" href="classUtils.html#a3eb90745a887172f3705ddc030b82ab3">Utils::computeCloudResolution</a>(<a class="code" href="classGICPAlignment.html#a6826da44323f592cd6fab9e87cef2a6d">_target_cloud</a>);</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keywordtype">double</span> source_res = <a class="code" href="classUtils.html#a3eb90745a887172f3705ddc030b82ab3">Utils::computeCloudResolution</a>(<a class="code" href="classGICPAlignment.html#abe80f79c8554e90e792f3352173104c6">_source_cloud</a>);</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <a class="code" href="classGICPAlignment.html#a24ee403ab8dad19831013ab4e1a87eed">_normal_radius</a> = (target_res + source_res) * 2.0; <span class="comment">// 2 times higher</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keywordtype">double</span> threshold = (target_res + source_res) * 0.95; <span class="comment">// just below resolution</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="comment">// setup Generalized-ICP</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <a class="code" href="classGICPAlignment.html#a66e4c64a8f53b781a748c581c28f1a3f">_gicp</a>.setMaxCorrespondenceDistance(100*threshold);</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <a class="code" href="classGICPAlignment.html#a66e4c64a8f53b781a748c581c28f1a3f">_gicp</a>.setMaximumIterations(100);</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <a class="code" href="classGICPAlignment.html#a66e4c64a8f53b781a748c581c28f1a3f">_gicp</a>.setEuclideanFitnessEpsilon(1); <span class="comment">// divergence criterion</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <a class="code" href="classGICPAlignment.html#a66e4c64a8f53b781a748c581c28f1a3f">_gicp</a>.setTransformationEpsilon(1e-9); <span class="comment">// convergence criterion</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <a class="code" href="classGICPAlignment.html#a66e4c64a8f53b781a748c581c28f1a3f">_gicp</a>.setRANSACOutlierRejectionThreshold(threshold);</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;}</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="classGICPAlignment.html#adc6c74c1c9b4f5060195ab1af4206c1f">   62</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classGICPAlignment.html#adc6c74c1c9b4f5060195ab1af4206c1f">GICPAlignment::getCovariances</a>(PointCloudRGB::Ptr cloud,</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;                                   boost::shared_ptr&lt;CovariancesVector&gt; covs)</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;{</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    pcl::PointCloud&lt;pcl::Normal&gt;::Ptr normals(<span class="keyword">new</span> pcl::PointCloud&lt;pcl::Normal&gt;);</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="comment">// pcl::features::computeApproximateNormals(*cloud, mesh-&gt;polygons, *normals); // NOT WORKING</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <a class="code" href="classUtils.html#aea5caf4c03b800a6d844868f9a5bdb97">Utils::getNormals</a>(cloud, <a class="code" href="classGICPAlignment.html#a24ee403ab8dad19831013ab4e1a87eed">_normal_radius</a>, normals);</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="comment">// filter NaN values</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    boost::shared_ptr&lt;std::vector&lt;int&gt; &gt; indices(<span class="keyword">new</span> std::vector&lt;int&gt;); <span class="comment">// Interest points</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    pcl::removeNaNFromPointCloud(*cloud,*cloud,*indices);</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    pcl::removeNaNNormalsFromPointCloud(*normals,*normals,*indices);</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <a class="code" href="classUtils.html#af409af78969c505d1c18f3f223dba53d">Utils::indicesFilter</a>(cloud, cloud, indices);</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="comment">// get covariances</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    pcl::features::computeApproximateCovariances(*cloud, *normals, *covs);</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keywordtype">bool</span> success = normals-&gt;points.size()==covs-&gt;size() ? <span class="keyword">true</span> : <span class="keyword">false</span>;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;}</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno"><a class="line" href="classGICPAlignment.html#aabbf7165ff9ce2b1d9518559434f0a54">   79</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classGICPAlignment.html#aabbf7165ff9ce2b1d9518559434f0a54">GICPAlignment::fineAlignment</a>(PointCloudRGB::Ptr source_cloud,</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                                  PointCloudRGB::Ptr target_cloud)</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;{</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    ROS_INFO(<span class="stringliteral">&quot;7. Extract covariances from clouds&quot;</span>);</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    boost::shared_ptr&lt;CovariancesVector&gt; source_covariances(<span class="keyword">new</span> <a class="code" href="classGICPAlignment.html#a3dfe79a3693f63ab65681621e824edec">CovariancesVector</a>);</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    boost::shared_ptr&lt;CovariancesVector&gt; target_covariances(<span class="keyword">new</span> <a class="code" href="classGICPAlignment.html#a3dfe79a3693f63ab65681621e824edec">CovariancesVector</a>);</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <a class="code" href="classGICPAlignment.html#adc6c74c1c9b4f5060195ab1af4206c1f">getCovariances</a>(source_cloud,source_covariances);</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <a class="code" href="classGICPAlignment.html#adc6c74c1c9b4f5060195ab1af4206c1f">getCovariances</a>(target_cloud,target_covariances);</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    ROS_INFO(<span class="stringliteral">&quot;8. Perform GICP with %d iterations&quot;</span>, <a class="code" href="classGICPAlignment.html#a66e4c64a8f53b781a748c581c28f1a3f">_gicp</a>.getMaximumIterations());</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    ros::Time begin = ros::Time::now();</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <a class="code" href="classGICPAlignment.html#a66e4c64a8f53b781a748c581c28f1a3f">_gicp</a>.setInputSource(source_cloud);</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <a class="code" href="classGICPAlignment.html#a66e4c64a8f53b781a748c581c28f1a3f">_gicp</a>.setInputTarget(target_cloud);</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <a class="code" href="classGICPAlignment.html#a66e4c64a8f53b781a748c581c28f1a3f">_gicp</a>.setSourceCovariances(source_covariances);</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <a class="code" href="classGICPAlignment.html#a66e4c64a8f53b781a748c581c28f1a3f">_gicp</a>.setTargetCovariances(target_covariances);</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="comment">// run Alignment and get transformation</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    PointCloudRGB::Ptr aligned_cloud(<span class="keyword">new</span> <a class="code" href="classGICPAlignment.html#a33aac7b6f7df6fda4d8403c7431b93a0">PointCloudRGB</a>);</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <a class="code" href="classGICPAlignment.html#a66e4c64a8f53b781a748c581c28f1a3f">_gicp</a>.align(*aligned_cloud);</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    ros::Duration exec_time = ros::Time::now()-begin;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    ROS_INFO(<span class="stringliteral">&quot;GICP time: %lf s&quot;</span>,exec_time.toSec());</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classGICPAlignment.html#a66e4c64a8f53b781a748c581c28f1a3f">_gicp</a>.hasConverged())</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    {</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        ROS_INFO(<span class="stringliteral">&quot;Converged in %f&quot;</span>,<a class="code" href="classGICPAlignment.html#a66e4c64a8f53b781a748c581c28f1a3f">_gicp</a>.getFitnessScore());</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        <a class="code" href="classGICPAlignment.html#acec7c1daa76528fde5a0edc20c386e06">_fine_tf</a> = <a class="code" href="classGICPAlignment.html#a66e4c64a8f53b781a748c581c28f1a3f">_gicp</a>.getFinalTransformation();</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        ROS_INFO(<span class="stringliteral">&quot;9. Transform result of gicp: &quot;</span>);</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        <a class="code" href="classGICPAlignment.html#a353796413dbd153536e5e6286502ddd8">transform_exists</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <a class="code" href="classGICPAlignment.html#a66e4c64a8f53b781a748c581c28f1a3f">_gicp</a>.setMaximumIterations(10); <span class="comment">// for future iterations</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    }</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="keywordflow">else</span> </div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    {</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        ROS_ERROR(<span class="stringliteral">&quot;NO CONVERGE&quot;</span>);</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    }</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;}</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno"><a class="line" href="classGICPAlignment.html#a8539204e89dbb2a8467420f0a5d77074">  116</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classGICPAlignment.html#a8539204e89dbb2a8467420f0a5d77074">GICPAlignment::iterateFineAlignment</a>(PointCloudRGB::Ptr cloud)</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;{</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <a class="code" href="classGICPAlignment.html#a047c516b4915f55ccc81e955a43d8ba5">backUp</a>(cloud); <span class="comment">// save a copy to restore in case iteration give wrong results</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    Eigen::Matrix4f temp_tf;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    ROS_INFO(<span class="stringliteral">&quot;Computing iteration...&quot;</span>);</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <a class="code" href="classGICPAlignment.html#a66e4c64a8f53b781a748c581c28f1a3f">_gicp</a>.align(*cloud);</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classGICPAlignment.html#a66e4c64a8f53b781a748c581c28f1a3f">_gicp</a>.hasConverged()) </div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    {</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        temp_tf = <a class="code" href="classGICPAlignment.html#a66e4c64a8f53b781a748c581c28f1a3f">_gicp</a>.getFinalTransformation();</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <a class="code" href="classGICPAlignment.html#acec7c1daa76528fde5a0edc20c386e06">_fine_tf</a> = temp_tf * <a class="code" href="classGICPAlignment.html#acec7c1daa76528fde5a0edc20c386e06">_fine_tf</a>;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <span class="comment">// Utils::printTransform(_fine_tf);</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        ROS_INFO(<span class="stringliteral">&quot;Converged in %f&quot;</span>,<a class="code" href="classGICPAlignment.html#a66e4c64a8f53b781a748c581c28f1a3f">_gicp</a>.getFitnessScore());</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    }</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    {</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        ROS_ERROR(<span class="stringliteral">&quot;no converge&quot;</span>);</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    }</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;}</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno"><a class="line" href="classGICPAlignment.html#a047c516b4915f55ccc81e955a43d8ba5">  137</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classGICPAlignment.html#a047c516b4915f55ccc81e955a43d8ba5">GICPAlignment::backUp</a>(PointCloudRGB::Ptr cloud)</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;{</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    pcl::copyPointCloud(*cloud, *<a class="code" href="classGICPAlignment.html#a6feaa2e5cbe621e4c997d2cbfa925ec1">_backup_cloud</a>);</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;}</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div><div class="line"><a name="l00142"></a><span class="lineno"><a class="line" href="classGICPAlignment.html#aa573375a26c9a89e3c280d11686cd320">  142</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classGICPAlignment.html#aa573375a26c9a89e3c280d11686cd320">GICPAlignment::undo</a>()</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;{</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    pcl::copyPointCloud(*<a class="code" href="classGICPAlignment.html#a6feaa2e5cbe621e4c997d2cbfa925ec1">_backup_cloud</a>, *<a class="code" href="classGICPAlignment.html#ac0d4e47bde2f8f7cc2c47b2389480a8f">_aligned_cloud</a>);</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;}</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno"><a class="line" href="classGICPAlignment.html#a5274769f0978ddf65db6af09e749b261">  147</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classGICPAlignment.html#a5274769f0978ddf65db6af09e749b261">GICPAlignment::applyTFtoCloud</a>(PointCloudRGB::Ptr cloud)</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;{</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    pcl::transformPointCloud(*cloud,*<a class="code" href="classGICPAlignment.html#ac0d4e47bde2f8f7cc2c47b2389480a8f">_aligned_cloud</a>,<a class="code" href="classGICPAlignment.html#acec7c1daa76528fde5a0edc20c386e06">_fine_tf</a>);</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;}</div><div class="ttc" id="classGICPAlignment_html_abe80f79c8554e90e792f3352173104c6"><div class="ttname"><a href="classGICPAlignment.html#abe80f79c8554e90e792f3352173104c6">GICPAlignment::_source_cloud</a></div><div class="ttdeci">PointCloudRGB::Ptr _source_cloud</div><div class="ttdoc">Source pointcloud. </div><div class="ttdef"><b>Definition:</b> <a href="GICPAlignment_8h_source.html#l00110">GICPAlignment.h:110</a></div></div>
<div class="ttc" id="classGICPAlignment_html_aa573375a26c9a89e3c280d11686cd320"><div class="ttname"><a href="classGICPAlignment.html#aa573375a26c9a89e3c280d11686cd320">GICPAlignment::undo</a></div><div class="ttdeci">void undo()</div><div class="ttdoc">Undo last iteration and back up results. </div><div class="ttdef"><b>Definition:</b> <a href="GICPAlignment_8cpp_source.html#l00142">GICPAlignment.cpp:142</a></div></div>
<div class="ttc" id="classGICPAlignment_html_adc6c74c1c9b4f5060195ab1af4206c1f"><div class="ttname"><a href="classGICPAlignment.html#adc6c74c1c9b4f5060195ab1af4206c1f">GICPAlignment::getCovariances</a></div><div class="ttdeci">void getCovariances(PointCloudRGB::Ptr cloud, boost::shared_ptr&lt; CovariancesVector &gt; covs)</div><div class="ttdoc">Get the covariances from cloud. </div><div class="ttdef"><b>Definition:</b> <a href="GICPAlignment_8cpp_source.html#l00062">GICPAlignment.cpp:62</a></div></div>
<div class="ttc" id="classGICPAlignment_html_a3dfe79a3693f63ab65681621e824edec"><div class="ttname"><a href="classGICPAlignment.html#a3dfe79a3693f63ab65681621e824edec">GICPAlignment::CovariancesVector</a></div><div class="ttdeci">std::vector&lt; Eigen::Matrix3d, Eigen::aligned_allocator&lt; Eigen::Matrix3d &gt; &gt; CovariancesVector</div><div class="ttdef"><b>Definition:</b> <a href="GICPAlignment_8h_source.html#l00025">GICPAlignment.h:25</a></div></div>
<div class="ttc" id="classGICPAlignment_html_af34f9575663c52fdce0796a7421dbb75"><div class="ttname"><a href="classGICPAlignment.html#af34f9575663c52fdce0796a7421dbb75">GICPAlignment::run</a></div><div class="ttdeci">void run()</div><div class="ttdoc">Perform GICP alignment. </div><div class="ttdef"><b>Definition:</b> <a href="GICPAlignment_8cpp_source.html#l00014">GICPAlignment.cpp:14</a></div></div>
<div class="ttc" id="classGICPAlignment_html_aabbf7165ff9ce2b1d9518559434f0a54"><div class="ttname"><a href="classGICPAlignment.html#aabbf7165ff9ce2b1d9518559434f0a54">GICPAlignment::fineAlignment</a></div><div class="ttdeci">void fineAlignment(PointCloudRGB::Ptr source_cloud, PointCloudRGB::Ptr target_cloud)</div><div class="ttdoc">Apply covariances to perform fine alignment. </div><div class="ttdef"><b>Definition:</b> <a href="GICPAlignment_8cpp_source.html#l00079">GICPAlignment.cpp:79</a></div></div>
<div class="ttc" id="classGICPAlignment_html_adbc117474b6263b415d8cc5704842a52"><div class="ttname"><a href="classGICPAlignment.html#adbc117474b6263b415d8cc5704842a52">GICPAlignment::configParameters</a></div><div class="ttdeci">void configParameters()</div><div class="ttdoc">Will set parameters to compute GICP alignment based on clouds data. </div><div class="ttdef"><b>Definition:</b> <a href="GICPAlignment_8cpp_source.html#l00045">GICPAlignment.cpp:45</a></div></div>
<div class="ttc" id="classGICPAlignment_html_a49a9a3ba2b38baee4359bfa390a1aa5a"><div class="ttname"><a href="classGICPAlignment.html#a49a9a3ba2b38baee4359bfa390a1aa5a">GICPAlignment::iterate</a></div><div class="ttdeci">void iterate()</div><div class="ttdoc">Do more iterations of GICP alignment. </div><div class="ttdef"><b>Definition:</b> <a href="GICPAlignment_8cpp_source.html#l00021">GICPAlignment.cpp:21</a></div></div>
<div class="ttc" id="classGICPAlignment_html_a5274769f0978ddf65db6af09e749b261"><div class="ttname"><a href="classGICPAlignment.html#a5274769f0978ddf65db6af09e749b261">GICPAlignment::applyTFtoCloud</a></div><div class="ttdeci">void applyTFtoCloud(PointCloudRGB::Ptr cloud)</div><div class="ttdoc">Once GICP is finished, apply fine transformation to source cloud. </div><div class="ttdef"><b>Definition:</b> <a href="GICPAlignment_8cpp_source.html#l00147">GICPAlignment.cpp:147</a></div></div>
<div class="ttc" id="classGICPAlignment_html_a63fdc9dad8f08643cd3901502d49845a"><div class="ttname"><a href="classGICPAlignment.html#a63fdc9dad8f08643cd3901502d49845a">GICPAlignment::GICPAlignment</a></div><div class="ttdeci">GICPAlignment(PointCloudRGB::Ptr target_cloud, PointCloudRGB::Ptr source_cloud)</div><div class="ttdoc">Construct a new GICPAlignment object. </div><div class="ttdef"><b>Definition:</b> <a href="GICPAlignment_8cpp_source.html#l00003">GICPAlignment.cpp:3</a></div></div>
<div class="ttc" id="classGICPAlignment_html_a6826da44323f592cd6fab9e87cef2a6d"><div class="ttname"><a href="classGICPAlignment.html#a6826da44323f592cd6fab9e87cef2a6d">GICPAlignment::_target_cloud</a></div><div class="ttdeci">PointCloudRGB::Ptr _target_cloud</div><div class="ttdoc">Target pointcloud. </div><div class="ttdef"><b>Definition:</b> <a href="GICPAlignment_8h_source.html#l00107">GICPAlignment.h:107</a></div></div>
<div class="ttc" id="classGICPAlignment_html_acec7c1daa76528fde5a0edc20c386e06"><div class="ttname"><a href="classGICPAlignment.html#acec7c1daa76528fde5a0edc20c386e06">GICPAlignment::_fine_tf</a></div><div class="ttdeci">Eigen::Matrix4f _fine_tf</div><div class="ttdoc">Transformation matrix as result of GICP alignment. </div><div class="ttdef"><b>Definition:</b> <a href="GICPAlignment_8h_source.html#l00101">GICPAlignment.h:101</a></div></div>
<div class="ttc" id="classGICPAlignment_html_a353796413dbd153536e5e6286502ddd8"><div class="ttname"><a href="classGICPAlignment.html#a353796413dbd153536e5e6286502ddd8">GICPAlignment::transform_exists</a></div><div class="ttdeci">bool transform_exists</div><div class="ttdoc">If true, fine transformation is finished. </div><div class="ttdef"><b>Definition:</b> <a href="GICPAlignment_8h_source.html#l00042">GICPAlignment.h:42</a></div></div>
<div class="ttc" id="classGICPAlignment_html_a8980d10505bf7567f1aded90734376df"><div class="ttname"><a href="classGICPAlignment.html#a8980d10505bf7567f1aded90734376df">GICPAlignment::getAlignedCloud</a></div><div class="ttdeci">void getAlignedCloud(PointCloudRGB::Ptr aligned_cloud)</div><div class="ttdoc">Get the aligned cloud object. </div><div class="ttdef"><b>Definition:</b> <a href="GICPAlignment_8cpp_source.html#l00033">GICPAlignment.cpp:33</a></div></div>
<div class="ttc" id="classGICPAlignment_html_a66e4c64a8f53b781a748c581c28f1a3f"><div class="ttname"><a href="classGICPAlignment.html#a66e4c64a8f53b781a748c581c28f1a3f">GICPAlignment::_gicp</a></div><div class="ttdeci">pcl::GeneralizedIterativeClosestPoint&lt; pcl::PointXYZRGB, pcl::PointXYZRGB &gt; _gicp</div><div class="ttdoc">GICP object. </div><div class="ttdef"><b>Definition:</b> <a href="GICPAlignment_8h_source.html#l00049">GICPAlignment.h:49</a></div></div>
<div class="ttc" id="classUtils_html_a25af90b468b8971e7d0e712bef9c7085"><div class="ttname"><a href="classUtils.html#a25af90b468b8971e7d0e712bef9c7085">Utils::_frame_id</a></div><div class="ttdeci">static std::string _frame_id</div><div class="ttdoc">frame_id to add in PointCloud2. Default to &quot;/world&quot;. </div><div class="ttdef"><b>Definition:</b> <a href="Utils_8h_source.html#l00060">Utils.h:60</a></div></div>
<div class="ttc" id="classGICPAlignment_html_a24ee403ab8dad19831013ab4e1a87eed"><div class="ttname"><a href="classGICPAlignment.html#a24ee403ab8dad19831013ab4e1a87eed">GICPAlignment::_normal_radius</a></div><div class="ttdeci">double _normal_radius</div><div class="ttdoc">Radius to compute normals. </div><div class="ttdef"><b>Definition:</b> <a href="GICPAlignment_8h_source.html#l00104">GICPAlignment.h:104</a></div></div>
<div class="ttc" id="classGICPAlignment_html_a33aac7b6f7df6fda4d8403c7431b93a0"><div class="ttname"><a href="classGICPAlignment.html#a33aac7b6f7df6fda4d8403c7431b93a0">GICPAlignment::PointCloudRGB</a></div><div class="ttdeci">pcl::PointCloud&lt; pcl::PointXYZRGB &gt; PointCloudRGB</div><div class="ttdef"><b>Definition:</b> <a href="GICPAlignment_8h_source.html#l00024">GICPAlignment.h:24</a></div></div>
<div class="ttc" id="classUtils_html_aea5caf4c03b800a6d844868f9a5bdb97"><div class="ttname"><a href="classUtils.html#aea5caf4c03b800a6d844868f9a5bdb97">Utils::getNormals</a></div><div class="ttdeci">static bool getNormals(PointCloudRGB::Ptr &amp;cloud, double normal_radius, pcl::PointCloud&lt; pcl::Normal &gt;::Ptr &amp;normals)</div><div class="ttdoc">Get the normals for input cloud with specified normal&amp;#39;s radius. </div><div class="ttdef"><b>Definition:</b> <a href="Utils_8cpp_source.html#l00008">Utils.cpp:8</a></div></div>
<div class="ttc" id="classUtils_html_a3eb90745a887172f3705ddc030b82ab3"><div class="ttname"><a href="classUtils.html#a3eb90745a887172f3705ddc030b82ab3">Utils::computeCloudResolution</a></div><div class="ttdeci">static double computeCloudResolution(PointCloudXYZ::Ptr cloud)</div><div class="ttdoc">Obtain the resolution of the cloud. </div><div class="ttdef"><b>Definition:</b> <a href="Utils_8cpp_source.html#l00085">Utils.cpp:85</a></div></div>
<div class="ttc" id="classGICPAlignment_html_a6feaa2e5cbe621e4c997d2cbfa925ec1"><div class="ttname"><a href="classGICPAlignment.html#a6feaa2e5cbe621e4c997d2cbfa925ec1">GICPAlignment::_backup_cloud</a></div><div class="ttdeci">PointCloudRGB::Ptr _backup_cloud</div><div class="ttdoc">Save aligned pointcloud to restore if undo. </div><div class="ttdef"><b>Definition:</b> <a href="GICPAlignment_8h_source.html#l00116">GICPAlignment.h:116</a></div></div>
<div class="ttc" id="classGICPAlignment_html_a8539204e89dbb2a8467420f0a5d77074"><div class="ttname"><a href="classGICPAlignment.html#a8539204e89dbb2a8467420f0a5d77074">GICPAlignment::iterateFineAlignment</a></div><div class="ttdeci">void iterateFineAlignment(PointCloudRGB::Ptr cloud)</div><div class="ttdoc">Re-iterate GICP and save new aligned cloud. </div><div class="ttdef"><b>Definition:</b> <a href="GICPAlignment_8cpp_source.html#l00116">GICPAlignment.cpp:116</a></div></div>
<div class="ttc" id="classUtils_html_af409af78969c505d1c18f3f223dba53d"><div class="ttname"><a href="classUtils.html#af409af78969c505d1c18f3f223dba53d">Utils::indicesFilter</a></div><div class="ttdeci">static void indicesFilter(PointCloudRGB::Ptr cloud_in, PointCloudRGB::Ptr cloud_out, boost::shared_ptr&lt; std::vector&lt; int &gt; &gt; indices)</div><div class="ttdoc">Apply extract indices filter to input cloud with given indices. </div><div class="ttdef"><b>Definition:</b> <a href="Utils_8cpp_source.html#l00153">Utils.cpp:153</a></div></div>
<div class="ttc" id="classGICPAlignment_html_ad0935eeab16c6f8fecf2ab618e618eaa"><div class="ttname"><a href="classGICPAlignment.html#ad0935eeab16c6f8fecf2ab618e618eaa">GICPAlignment::getAlignedCloudROSMsg</a></div><div class="ttdeci">void getAlignedCloudROSMsg(sensor_msgs::PointCloud2 &amp;aligned_cloud_msg)</div><div class="ttdoc">Get the aligned cloud msg in PointCloud2 format. </div><div class="ttdef"><b>Definition:</b> <a href="GICPAlignment_8cpp_source.html#l00038">GICPAlignment.cpp:38</a></div></div>
<div class="ttc" id="classGICPAlignment_html_ac13e747b98b90f29e47024450b4e0fba"><div class="ttname"><a href="classGICPAlignment.html#ac13e747b98b90f29e47024450b4e0fba">GICPAlignment::getFineTransform</a></div><div class="ttdeci">Eigen::Matrix4f getFineTransform()</div><div class="ttdoc">Get the fine transform object. </div><div class="ttdef"><b>Definition:</b> <a href="GICPAlignment_8cpp_source.html#l00026">GICPAlignment.cpp:26</a></div></div>
<div class="ttc" id="GICPAlignment_8h_html"><div class="ttname"><a href="GICPAlignment_8h.html">GICPAlignment.h</a></div></div>
<div class="ttc" id="classGICPAlignment_html_a047c516b4915f55ccc81e955a43d8ba5"><div class="ttname"><a href="classGICPAlignment.html#a047c516b4915f55ccc81e955a43d8ba5">GICPAlignment::backUp</a></div><div class="ttdeci">void backUp(PointCloudRGB::Ptr cloud)</div><div class="ttdoc">Store cloud as backup cloud. </div><div class="ttdef"><b>Definition:</b> <a href="GICPAlignment_8cpp_source.html#l00137">GICPAlignment.cpp:137</a></div></div>
<div class="ttc" id="classGICPAlignment_html_ac0d4e47bde2f8f7cc2c47b2389480a8f"><div class="ttname"><a href="classGICPAlignment.html#ac0d4e47bde2f8f7cc2c47b2389480a8f">GICPAlignment::_aligned_cloud</a></div><div class="ttdeci">PointCloudRGB::Ptr _aligned_cloud</div><div class="ttdoc">Source pointcloud aligned with target cloud. </div><div class="ttdef"><b>Definition:</b> <a href="GICPAlignment_8h_source.html#l00113">GICPAlignment.h:113</a></div></div>
</div><!-- fragment --></div><!-- contents -->

<br clear="all" />
<hr size="1"><div style="align: right;">
<a href="http://wiki.ros.org/leica_point_cloud_processing">leica_point_cloud_processing</a><br />
Author(s): Ines Lara Sicilia <imlara@catec.aero></br />
<small>autogenerated on Fri Jul 31 2020 08:28:37</small>
</div>
</body>
</html>
